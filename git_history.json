[
    {
        "hash": "25d100f1de7fc327803fc389c84b3f94e37a92a1",
        "short_hash": "25d100f",
        "author": "John",
        "date": "2025-12-21T19:01:24",
        "message": "feat: Add validation criteria to cache key and initialize cache\n\n  Refactors the handling of validation criteria to be more direct and robust. The validation criteria are now included in the cache key to prevent stale cache\n  returns when the criteria change.\n\n  Key changes:\n   - Extracts validation criteria directly from the task configuration in generate_output.\n   - Removes the passing of validation criteria through the PromptConstructor.\n   - Adds init_cache_db() to main.py to ensure the cache database is initialized on application startup.",
        "diff": "--- FILE: app/logic_handler_react.py ---\n@@ -327,14 +327,12 @@ class PromptConstructor:\n         system_prompt = self.template.get(\"system_prompt\", \"\")\n         user_prompt_template = self.template.get(\"user_prompt\", \"\")\n         formatted_examples = self.build_examples()\n-        validation_criteria = self.template.get(\"validation_criteria\", \"\")\n-\n         \n         # Handle legacy format with single {raw_text} placeholder\n         if not is_new_format(self.template):\n             combined_text = next(iter(self.text_files.values()), \"\")\n             final_user_prompt = user_prompt_template.replace(\"{raw_text}\", combined_text)\n-            return system_prompt, final_user_prompt, db_text.strip(), formatted_examples, validation_criteria\n+            return system_prompt, final_user_prompt, combined_text, formatted_examples\n \n         # Handle new format with multiple variables\n         variables = self.template.get(\"variables\", {})\n@@ -357,7 +355,7 @@ class PromptConstructor:\n         if self.image_files:\n             db_text += \"\\n[IMAGES: \" + \", \".join(img[\"filename\"] for img in self.image_files) + \"]\"\n         \n-        return system_prompt, final_user_prompt, db_text.strip(), formatted_examples, validation_criteria\n+        return system_prompt, final_user_prompt, db_text.strip(), formatted_examples\n \n \n # --------------------------------------------------------------------------- #\n@@ -448,12 +446,15 @@ def generate_output(\n         \n         # Build prompts using the constructor\n         constructor = PromptConstructor(task_config, dynamic_inputs, text_contents, image_data)\n-        system_prompt, user_prompt, raw_text_for_db, formatted_examples, validation_criteria = constructor.build()\n+        system_prompt, user_prompt, raw_text_for_db, formatted_examples = constructor.build()\n+\n+        # 1. Extract validation_criteria from the task config\n+        validation_criteria = task_config.get(\"validation_criteria\", \"\")\n \n         # Generate cache key based on all relevant parameters\n         image_summary_for_key = json.dumps(sorted(img[\"filename\"] for img in image_data))\n         examples_summary_for_key = json.dumps(formatted_examples)\n-        cache_key_str = f\"{ai_provider}:{model_name}:{system_prompt}:{user_prompt}:{image_summary_for_key}:{examples_summary_for_key}\"\n+        cache_key_str = f\"{ai_provider}:{model_name}:{system_prompt}:{user_prompt}:{image_summary_for_key}:{examples_summary_for_key}:{validation_criteria}\"\n         cache_key = hashlib.md5(cache_key_str.encode()).hexdigest()\n         \n         # Check cache for existing response\n@@ -495,11 +496,11 @@ def generate_output(\n         ai_content, prompt_tokens, completion_tokens = strategy.execute_request(\n             system_prompt=system_prompt,\n             user_prompt=user_prompt,\n-            validation_criteria=validation_criteria,\n             max_tokens=max_tokens,\n             temperature=temperature,\n             images=image_data,\n             few_shot_examples=formatted_examples,\n+            validation_criteria=validation_criteria,\n         )\n         api_latency = time.time() - api_start_time\n         console_logger.info(f\"API response received in {api_latency:.2f}s.\")\n@@ -578,5 +579,3 @@ def generate_output(\n     except Exception as e:\n         console_logger.error(f\"An error occurred in 'generate_output': {e}\", exc_info=True)\n         raise\n-\n-\n\n--- FILE: app/main.py ---\n@@ -30,6 +30,7 @@ from . import logic_handler_react\n from .model_config_react import ALL_MODEL_CONFIGS\n from .file_converter_utils import convert_text_to_format\n from .facts_util import get_random_fact\n+from . import cache_utils_react\n \n class RatingCreate(BaseModel):\n     rating: int\n@@ -38,6 +39,10 @@ class RatingCreate(BaseModel):\n # --- FastAPI App Initialization and CORS ---\n app = FastAPI(title=\"AI Workbench API\")\n origins = [\"http://localhost:3000\"]\n+\n+# Initialize the cache database on startup\n+cache_utils_react.init_cache_db()\n+\n app.add_middleware(\n     CORSMiddleware,\n     allow_origins=origins,\n"
    },
    {
        "hash": "ee0d3a55aa448f4734996538bac4b824e158233d",
        "short_hash": "ee0d3a5",
        "author": "John",
        "date": "2025-12-15T00:00:15",
        "message": "feat: add Python Analysis Markdown Generator with customizable output styles and validation criteria",
        "diff": "--- FILE: app/prompt_templates_react.json ---\n@@ -4518,5 +4518,51 @@\n       }\n     ],\n     \"validation_criteria\": \"- The output must be a single, valid JSON object.\\n- The JSON object must strictly adhere to the schema defined in the user prompt (keys: summary, dependencies, global_variables, functions, classes, error).\\n- All functions, classes, and top-level imports from the script must be identified and included in the output.\\n- Docstrings, parameters, and type hints must be accurately extracted, using fallbacks like 'unknown' where necessary.\\n- Error field must be populated for invalid inputs, with other fields minimized.\\n- Guardrails must prevent analysis of oversized or malicious content.\"\n+  },\n+  \"Python Analysis Markdown Generator\": {\n+    \"category\": \"Developer Tools\",\n+    \"output_type\": \"text\",\n+    \"metadata\": {\n+      \"version\": \"1.0.0\",\n+      \"complexity_level\": \"advanced\",\n+      \"description\": \"Transforms the JSON output from Python script analysis into a structured, professional Markdown document, customizable via selected style (minimal, detailed, or wiki).\"\n+    },\n+    \"variables\": {\n+      \"json_analysis\": {\n+        \"type\": \"textbox\",\n+        \"description\": \"Paste the complete JSON output from the 'Python Script To Json Analyzer' template here. Must be valid JSON matching the analysis schema.\",\n+        \"required\": true\n+      },\n+      \"document_style\": {\n+        \"type\": \"dropdown\",\n+        \"description\": \"Select Markdown style: 'minimal' (concise bullet-point overview), 'detailed' (comprehensive with tables and code blocks), 'wiki' (GitHub Wiki format with badges, expandable sections, and navigation).\",\n+        \"required\": true,\n+        \"options\": [\n+          \"minimal\",\n+          \"detailed\",\n+          \"wiki\"\n+        ],\n+        \"default\": \"detailed\"\n+      }\n+    },\n+    \"system_prompt\": \"You are an expert technical documentation AI specializing in Python code. Your role is to convert the provided JSON analysis of a Python script into a high-quality, structured Markdown document tailored to the user's selected style. Parse the JSON accurately, handle errors gracefully by highlighting them, and ensure the output is clean, readable Markdown with appropriate headings, lists, tables, and code blocks. Never add information not present in the JSON. Styles must be strictly followed:\\n- 'minimal': Ultra-concise summary with bullets only.\\n- 'detailed': Full breakdown using H2/H3 headings, tables for variables/functions/classes, inline code for names/types.\\n- 'wiki': Wiki-style with infobox, badges (e.g., ![badge](data:image/svg+xml,...)), tables, and collapsible details.\",\n+    \"user_prompt\": \"Convert the following JSON analysis of a Python script into a structured Markdown document in the '{document_style}' style:\\n\\n{json_analysis}\\n\\n**Style Guidelines:**\\n- **minimal**: Single-page overview with bullets for summary, deps, globals, functions/classes.\\n- **detailed**: Hierarchical headings (## Summary, ## Dependencies, etc.), tables for structured data (e.g., | Name | Type |), code blocks for docstrings.\\n- **wiki**: Use badges for deps (e.g., `![os](https://img.shields.io/badge/os-blue)`), sidebar table of contents, details/summary tags for methods.\\n\\nIf 'error' is present, make it the top section with a warning badge. Output only pure Markdown, no additional text.\",\n+    \"examples\": [\n+      {\n+        \"input\": {\n+          \"json_analysis\": \"{\\\"summary\\\": \\\"A script that defines a global variable for an API key from environment variables and includes a single function 'greet' to return a formatted greeting string.\\\", \\\"dependencies\\\": [\\\"os\\\"], \\\"global_variables\\\": [{\\\"name\\\": \\\"API_KEY\\\", \\\"inferred_type\\\": \\\"string\\\"}], \\\"functions\\\": [{\\\"name\\\": \\\"greet\\\", \\\"parameters\\\": [{\\\"name\\\": \\\"name\\\", \\\"type_hint\\\": \\\"str\\\"}], \\\"docstring\\\": \\\"A simple function to greet someone.\\\", \\\"returns\\\": \\\"str\\\"}], \\\"classes\\\": [], \\\"error\\\": null}\",\n+          \"document_style\": \"detailed\"\n+        },\n+        \"output\": \"# Python Script Documentation\\n\\n## Summary\\nA script that defines a global variable for an API key from environment variables and includes a single function 'greet' to return a formatted greeting string.\\n\\n## Dependencies\\n```\\nos\\n```\\n\\n## Global Variables\\n\\n| Name    | Inferred Type |\\n|---------|---------------|\\n| API_KEY | string        |\\n\\n## Functions\\n### `greet(name: str) -> str`\\n**Parameters:**\\n\\n| Name | Type Hint |\\n|------|-----------|\\n| name | str       |\\n\\n**Docstring:**\\n```\\nA simple function to greet someone.\\n```\\n\\n**Returns:** `str`\"\n+      },\n+      {\n+        \"input\": {\n+          \"json_analysis\": \"{\\\"summary\\\": \\\"\\\", \\\"dependencies\\\": [], \\\"global_variables\\\": [], \\\"functions\\\": [], \\\"classes\\\": [], \\\"error\\\": \\\"Syntax error detected in script: invalid function definition.\\\"}\",\n+          \"document_style\": \"minimal\"\n+        },\n+        \"output\": \"## Error\\n- **Syntax error detected in script: invalid function definition.**\\n\\nNo dependencies, globals, functions, or classes could be analyzed.\"\n+      }\n+    ],\n+    \"validation_criteria\": \"- Output is pure, valid Markdown syntax with no JSON or extraneous text.\\n- Structure and depth match the selected 'document_style' (minimal: bullets only; detailed: tables/headings; wiki: badges/details).\\n- All JSON fields (summary, dependencies, globals, functions, classes, error) are accurately represented without omissions or inventions.\\n- Error handling: Prominent warning if 'error' is non-null.\\n- Professional, readable formatting suitable for README.md or docs sites.\"\n   }\n-}\n+}\n\\ No newline at end of file\n"
    },
    {
        "hash": "4c558ec271e895c6e2b383ddd40d483ee9dcd04d",
        "short_hash": "4c558ec",
        "author": "John",
        "date": "2025-12-14T23:05:45",
        "message": "python script to analyzer v2",
        "diff": "--- FILE: app/prompt_templates_react.json ---\n@@ -4454,7 +4454,7 @@\n     \"category\": \"Developer Tools\",\n     \"output_type\": \"json\",\n     \"metadata\": {\n-      \"version\": \"1.0.0\",\n+      \"version\": \"1.1.0\",\n       \"complexity_level\": \"advanced\",\n       \"description\": \"Analyzes a Python script and converts its structure, functions, and dependencies into a structured JSON object for documentation.\"\n     },\n@@ -4468,8 +4468,8 @@\n         ]\n       }\n     },\n-    \"system_prompt\": \"You are an expert code analyst AI specializing in Python. Your purpose is to parse Python scripts and generate a structured, comprehensive JSON representation of their contents. You must strictly adhere to the requested JSON output schema. Your analysis should be accurate and detailed, focusing on creating machine-readable documentation.\",\n-    \"user_prompt\": \"Analyze the provided Python script: {python_script_file}. Generate a JSON object that documents its structure. The JSON output must strictly follow this schema: {\\\"summary\\\": \\\"string\\\", \\\"dependencies\\\": [\\\"string\\\"], \\\"global_variables\\\": [{\\\"name\\\": \\\"string\\\", \\\"inferred_type\\\": \\\"string\\\"}], \\\"functions\\\": [{\\\"name\\\": \\\"string\\\", \\\"parameters\\\": [{\\\"name\\\": \\\"string\\\", \\\"type_hint\\\": \\\"string|null\\\"}], \\\"docstring\\\": \\\"string|null\\\", \\\"returns\\\": \\\"string|null\\\"}], \\\"classes\\\": [{\\\"name\\\": \\\"string\\\", \\\"docstring\\\": \\\"string|null\\\", \\\"methods\\\": [{\\\"name\\\": \\\"string\\\", \\\"parameters\\\": [{\\\"name\\\": \\\"string\\\", \\\"type_hint\\\": \\\"string|null\\\"}], \\\"docstring\\\": \\\"string|null\\\"}]}]}.\\n\\n**Schema Definitions:**\\n- **summary:** A brief overview of the script's purpose and functionality.\\n- **dependencies:** A list of all external libraries or modules imported in the script.\\n- **global_variables:** A list of global variables defined at the top level, including their names and inferred types (e.g., int, str, list).\\n- **functions:** A list of all functions defined in the script, including their names, parameters (with type hints if available), docstrings, and return types.\\n- **classes:** A list of all classes defined in the script, including their names, docstrings, and methods (with similar details as functions).\\n\\nEnsure that your output is a single JSON object that strictly adheres to this schema.\",\n+    \"system_prompt\": \"You are an expert code analyst AI specializing in Python. Your purpose is to parse Python scripts and generate a structured, comprehensive JSON representation of their contents. You must strictly adhere to the requested JSON output schema. Your analysis should be accurate and detailed, focusing on creating machine-readable documentation. Before analysis, perform safety checks: reject files over 10,000 lines or containing potential malicious patterns (e.g., unsafe 'exec' or 'eval'). For edge cases like syntax errors, empty files, or non-Python content, populate the 'error' field and minimize other fields. Use fallbacks like 'unknown' for unparseable elements (e.g., type hints or docstrings).\",\n+    \"user_prompt\": \"Analyze the provided Python script: {python_script_file}. Generate a JSON object that documents its structure. The JSON output must strictly follow this schema: {\\\"summary\\\": \\\"string\\\", \\\"dependencies\\\": [\\\"string\\\"], \\\"global_variables\\\": [{\\\"name\\\": \\\"string\\\", \\\"inferred_type\\\": \\\"string|unknown\\\"}], \\\"functions\\\": [{\\\"name\\\": \\\"string\\\", \\\"parameters\\\": [{\\\"name\\\": \\\"string\\\", \\\"type_hint\\\": \\\"string|null|unknown\\\"}], \\\"docstring\\\": \\\"string|null\\\", \\\"returns\\\": \\\"string|null|unknown\\\"}], \\\"classes\\\": [{\\\"name\\\": \\\"string\\\", \\\"docstring\\\": \\\"string|null\\\", \\\"methods\\\": [{\\\"name\\\": \\\"string\\\", \\\"parameters\\\": [{\\\"name\\\": \\\"string\\\", \\\"type_hint\\\": \\\"string|null|unknown\\\"}], \\\"docstring\\\": \\\"string|null\\\"}]}], \\\"error\\\": \\\"string|null\\\"}.\\n\\n**Schema Definitions:**\\n- **summary:** A brief overview of the script's purpose and functionality (or error summary if applicable).\\n- **dependencies:** A list of all external libraries or modules imported in the script.\\n- **global_variables:** A list of global variables defined at the top level, including their names and inferred types (e.g., int, str, list, or 'unknown').\\n- **functions:** A list of all functions defined in the script, including their names, parameters (with type hints if available or 'unknown'), docstrings, and return types (or 'unknown').\\n- **classes:** A list of all classes defined in the script, including their names, docstrings, and methods (with similar details as functions).\\n- **error:** A descriptive error message if analysis fails (e.g., 'Syntax error detected') or null if successful.\\n\\nIf issues are detected, set 'error' to a message and use empty arrays/null for other fields where appropriate. Ensure that your output is a single JSON object that strictly adheres to this schema.\",\n     \"examples\": [\n       {\n         \"input\": {\n@@ -4499,10 +4499,24 @@\n               \"returns\": \"str\"\n             }\n           ],\n-          \"classes\": []\n+          \"classes\": [],\n+          \"error\": null\n+        }\n+      },\n+      {\n+        \"input\": {\n+          \"python_script_file\": \"def invalid_syntax: pass\"\n+        },\n+        \"output\": {\n+          \"summary\": \"\",\n+          \"dependencies\": [],\n+          \"global_variables\": [],\n+          \"functions\": [],\n+          \"classes\": [],\n+          \"error\": \"Syntax error detected in script: invalid function definition.\"\n         }\n       }\n     ],\n-    \"validation_criteria\": \"- The output must be a single, valid JSON object.\\n- The JSON object must strictly adhere to the schema defined in the user prompt (keys: summary, dependencies, global_variables, functions, classes).\\n- All functions, classes, and top-level imports from the script must be identified and included in the output.\\n- Docstrings, parameters, and type hints must be accurately extracted.\"\n+    \"validation_criteria\": \"- The output must be a single, valid JSON object.\\n- The JSON object must strictly adhere to the schema defined in the user prompt (keys: summary, dependencies, global_variables, functions, classes, error).\\n- All functions, classes, and top-level imports from the script must be identified and included in the output.\\n- Docstrings, parameters, and type hints must be accurately extracted, using fallbacks like 'unknown' where necessary.\\n- Error field must be populated for invalid inputs, with other fields minimized.\\n- Guardrails must prevent analysis of oversized or malicious content.\"\n   }\n-}\n\\ No newline at end of file\n+}\n"
    }
]